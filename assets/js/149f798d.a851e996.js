"use strict";(self.webpackChunkdocusaurus_blog=self.webpackChunkdocusaurus_blog||[]).push([[622],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(n),h=a,c=u["".concat(s,".").concat(h)]||u[h]||m[h]||i;return n?r.createElement(c,o(o({ref:t},p),{},{components:n})):r.createElement(c,o({ref:t},p))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2628:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var r=n(7462),a=(n(7294),n(3905));const i={slug:"2023/flutter-web-renderers/",title:"Flutter Web Renderers (as of Flutter 3.10)",date:"2023-06-14 15:20:00 +0530",tags:["Flutter","Tech"],authors:["immadisairaj"],comments:!0,image:"./thumbnail.png"},o=void 0,l={permalink:"/blog/2023/flutter-web-renderers/",source:"@site/blog/2023-06-14-flutter-web-renderers/index.mdx",title:"Flutter Web Renderers (as of Flutter 3.10)",description:"Are you always confused why your Flutter app on the web gives out some lags, errors or sometimes with even no proper colors on images? Think no further to read this blog to learn everything about Flutter Web that can help you solve your problems or understand Flutter Web better for your new/existing web application.",date:"2023-06-14T15:20:00.000Z",formattedDate:"June 14, 2023",tags:[{label:"Flutter",permalink:"/blog/tags/flutter"},{label:"Tech",permalink:"/blog/tags/tech"}],readingTime:14.22,hasTruncateMarker:!0,authors:[{name:"Sai Rajendra Immadi",title:"Flutter Developer",url:"https://github.com/immadisairaj",imageURL:"https://github.com/immadisairaj.png",key:"immadisairaj"}],frontMatter:{slug:"2023/flutter-web-renderers/",title:"Flutter Web Renderers (as of Flutter 3.10)",date:"2023-06-14 15:20:00 +0530",tags:["Flutter","Tech"],authors:["immadisairaj"],comments:!0,image:"./thumbnail.png"},nextItem:{title:"GitHub Actions to deploy Flutter Web to gh-pages",permalink:"/blog/2022/github-actions-for-flutter-web/"}},s={image:n(1544).Z,authorsImageUrls:[void 0]},d=[{value:"Renderer",id:"renderer",level:2},{value:"Types of renderers",id:"types-of-renderers",level:3},{value:"Development",id:"development",level:3},{value:"Use Renderer",id:"use-renderer",level:2},{value:"Pros and Cons",id:"pros-and-cons",level:2},{value:"HTML renderer",id:"html-renderer",level:3},{value:"CanvasKit renderer",id:"canvaskit-renderer",level:3},{value:"In Detail",id:"in-detail",level:2},{value:"Simple Rendering",id:"simple-rendering",level:3},{value:"Native Text Rendering",id:"native-text-rendering",level:3},{value:"Solution 1",id:"solution-1",level:4},{value:"Solution 2",id:"solution-2",level:4},{value:"Problematic SVG support",id:"problematic-svg-support",level:3},{value:"Canvas API limitations",id:"canvas-api-limitations",level:3},{value:"Images in Flutter Web",id:"images-in-flutter-web",level:3},{value:"Cross-Origin Resource Sharing (CORS)",id:"cross-origin-resource-sharing-cors",level:3},{value:"Solution",id:"solution",level:4},{value:"What to Choose?",id:"what-to-choose",level:2},{value:"Future - WASM",id:"future---wasm",level:2},{value:"Conclusion",id:"conclusion",level:2}],p={toc:d},u="wrapper";function m(e){let{components:t,...i}=e;return(0,a.kt)(u,(0,r.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Are you always confused why your Flutter app on the web gives out some lags, errors or sometimes with even no proper colors on images? Think no further to read this blog to learn everything about Flutter Web that can help you solve your problems or understand Flutter Web better for your new/existing web application."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Flutter Web Renderers Thumbnail",src:n(1544).Z,width:"2880",height:"1614"})),(0,a.kt)("h2",{id:"renderer"},"Renderer"),(0,a.kt)("p",null,"A renderer is something under the hood that a framework does (flutter here) to render the web application. In Flutter 3.10 (stable channel), the dart code is compiled to js using ",(0,a.kt)("a",{parentName:"p",href:"https://dart.dev/tools/dart2js"},"dart2js")," so a web browser can interpret it. "),(0,a.kt)("p",null,"I won't go deep into how rendering works, but here is a small story you need to know. Flutter engine, written in C++, web doesn't have access to the underlying engine, unlike mobile and desktop. With this, Fluter needed a different approach to render on the web. With the need for a different approach, Flutter had to reimplement the engine on top of browser-specific API only for the web."),(0,a.kt)("h3",{id:"types-of-renderers"},"Types of renderers"),(0,a.kt)("p",null,"The first approach for Flutter was to use HTML elements, CSS and ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API"},"Canvas API"),". Here the Flutter engine creates HTML elements and then puts out the styling and arrangement using the Canvas API. This renderer is named ",(0,a.kt)("strong",{parentName:"p"},"HTML"),"."),(0,a.kt)("p",null,"The second approach for Flutter is to bring the ",(0,a.kt)("a",{parentName:"p",href:"https://skia.org"},"SKIA")," (graphics engine) compiled to Web Assembly using the ",(0,a.kt)("a",{parentName:"p",href:"https://skia.org/docs/user/modules/canvaskit/"},"Canvas Kit"),". Here the Flutter engine creates Canvas elements and uses the Canvas Kit API to style the canvas. This method brings more control and flexibility as the Flutter engine uses SKIA (slowly moving to Impeller on mobile) to render. This renderer is named ",(0,a.kt)("strong",{parentName:"p"},"CanvasKit"),"."),(0,a.kt)("figure",null,(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Flutter web architectural layer",src:n(8376).Z,width:"1836",height:"846"})),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Flutter web architectural layer")),(0,a.kt)("h3",{id:"development"},"Development"),(0,a.kt)("p",null,"Flutter is known for its ",(0,a.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/tools/hot-reload"},"hot reload")," feature. But, with the different approach needed for Flutter Web, we don't get to experience this feature. So, to solve this, Flutter uses ",(0,a.kt)("a",{parentName:"p",href:"https://dart.dev/tools/dartdevc"},"dartdevc")," that supports an incremental compilation during the development process and supports hot restart (not hot reload). It uses the ",(0,a.kt)("a",{parentName:"p",href:"https://dart.dev/tools/dart2js"},"dart2js")," when creating production apps."),(0,a.kt)("h2",{id:"use-renderer"},"Use Renderer"),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"--web-renderer")," command line option:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"auto (default)"),(0,a.kt)("li",{parentName:"ul"},"html"),(0,a.kt)("li",{parentName:"ul"},"canvaskit")),(0,a.kt)("p",null,"By default, Flutter uses auto (no need to specify anything). It uses the ",(0,a.kt)("em",{parentName:"p"},"html")," renderer on mobile and ",(0,a.kt)("em",{parentName:"p"},"canvaskit")," renderer on desktop browsers."),(0,a.kt)("p",null,"Example usage for the run or build subcommands:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"flutter run -d chrome --web-renderer html\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"flutter build web --web-renderer canvaskit\n")),(0,a.kt)("p",null,"There is also an option to override the renderer at run-time."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="web/index.html"',title:'"web/index.html"'},'<body>\n  <script>\n    let useHtml = true;\n\n    window.addEventListener(\'load\', function(ev) {\n    _flutter.loader.loadEntrypoint({\n      serviceWorker: {\n        serviceWorkerVersion: serviceWorkerVersion,\n      },\n      onEntrypointLoaded: function(engineInitializer) {\n        // Run-time engine configuration\n        let config = {\n          renderer: useHtml ? "html" : "canvaskit",\n        };\n        engineInitializer.initializeEngine(config).then(function(appRunner) {\n          appRunner.runApp();\n        });\n      }\n    });\n  });\n  <\/script>\n</body>\n')),(0,a.kt)("p",null,"To learn more about the usage of renderers, visit ",(0,a.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/platform-integration/web/renderers"},"Flutter docs"),"."),(0,a.kt)("h2",{id:"pros-and-cons"},"Pros and Cons"),(0,a.kt)("p",null,"Everything has advantages and disadvantages. Let us look at what they are in different renderers."),(0,a.kt)("h3",{id:"html-renderer"},"HTML renderer"),(0,a.kt)("p",null,"This renderer uses a combination of HTML Elements, CSS, Canvas Elements & SVG Elements to render the web page. It is pretty straightforward (as mentioned above) in how it lays the components."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"+'s:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Have a lesser bundle size"),(0,a.kt)("li",{parentName:"ul"},"Faster initialization"),(0,a.kt)("li",{parentName:"ul"},"Use native text rendering")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"-'s:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Problematic SVG support"),(0,a.kt)("li",{parentName:"ul"},"Few Canvas APIs don't work properly")),(0,a.kt)("h3",{id:"canvaskit-renderer"},"CanvasKit renderer"),(0,a.kt)("p",null,"This renderer (as mentioned above) uses CanvasKit to render the web page. CanvasKit uses ",(0,a.kt)("a",{parentName:"p",href:"https://www.khronos.org/webgl/"},"WebGL"),", a graphics API, to execute SKIA paint commands. It is on par with the Flutter mobile and desktop applications."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"+'s:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Faster performance"),(0,a.kt)("li",{parentName:"ul"},"Higher widget density"),(0,a.kt)("li",{parentName:"ul"},"Browser independent")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"-'s:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Adds 1.5MB of bundle size"),(0,a.kt)("li",{parentName:"ul"},"Doesn't use native text rendering"),(0,a.kt)("li",{parentName:"ul"},"CORS issues")),(0,a.kt)("h2",{id:"in-detail"},"In Detail"),(0,a.kt)("p",null,"We've learnt about the renderers in general. Now, it's time to dive into various topics related to renderers."),(0,a.kt)("h3",{id:"simple-rendering"},"Simple Rendering"),(0,a.kt)("p",null,"Let us consider a sample code that consists of only texts to look at the difference in the rendering and their elements."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart",metastring:'title="Example code for simple rendering."',title:'"Example',code:!0,for:!0,simple:!0,'rendering."':!0},"Column(\n    children: const [\n        Text('This is center aligned'),\n        Align(\n            alignment: Alignment.topLeft,\n            child: Text('This is left aligned'),\n        ),\n        Align(\n            alignment: Alignment.topRight,\n            child: Text('This is right aligned'),\n        ),\n        Padding(\n            padding: EdgeInsets.only(left: 10),\n            child: Text('This is center +10 aligned'),\n        ),\n        Padding(\n            padding: EdgeInsets.only(right: 10),\n            child: Text('This is center -10 aligned'),\n        ),\n    ],\n),\n")),(0,a.kt)("p",null,"Output for the above code would be this (below image) for any renderer:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Simple rendering output",src:n(4713).Z,width:"864",height:"212"})),(0,a.kt)("p",null,"But we will find the actual difference when inspecting the page. It is as follows:"),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(8901).Z,width:"55%",style:{marginRight:"8px"},alt:"Simple rendering html 1"}),(0,a.kt)("img",{src:n(730).Z,width:"34%",style:{marginLeft:"8px"},alt:"Simple rendering html 2"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Simple rendering inspect - html")),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(9948).Z,alt:"Simple rendering canvaskit"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Simple rendering inspect - canvaskit")),(0,a.kt)("p",null,"Looking at the HTML elements from both renderers, it is clear that the HTML renderer uses different HTML and Canvas elements to render the widgets, while the CanvasKit renderer uses only one Canvas element and paints the page using APIs. This technique makes the CanvasKit renderer perform better, be consistent with mobile and desktop and make it browser independent (as it just paints and does not depend on browser compatibility of elements)."),(0,a.kt)("p",null,"CanvasKit, to be able to use the CanvasAPI and WebGL, has to ship a bit more files than HTML, which makes the web built using HTML renderer load faster. The difference in default download size is 1.5MB more in CanvasKit render. It was 2MB before, which tells us that the Flutter team is working hard on improving things daily."),(0,a.kt)("p",null,"Wow!! With just one section, we covered most of the pros and cons of both renderers. Let's learn about the remaining things left."),(0,a.kt)("h3",{id:"native-text-rendering"},"Native Text Rendering"),(0,a.kt)("p",null,"I used this term above, mentioning it is an advantage in HTML rendering and a disadvantage in CanvasKit rendering. To experiment on this, let us consider an example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart",metastring:'title="Example code for native text rendering."',title:'"Example',code:!0,for:!0,native:!0,text:!0,'rendering."':!0},"Center(\n    child: Text('Using Emoji - \ud83e\udee8'),\n),\n")),(0,a.kt)("p",null,"Time to render this sample code in both renderers, starting with the HTML renderer."),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(8401).Z,alt:"Native text rendering html output"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Native text rendering - html renderer output")),(0,a.kt)("p",null,"There is no problem here, and the output is as expected. So, why bother? Let's look at how the CanvasKit renderer renders for the answer."),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(8963).Z,alt:"Native text rendering canvaskit output"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Native text rendering - canvaskit renderer output")),(0,a.kt)("p",null,'Why did we go back in time (black and white emoji)? You might now start to think "native text rendering" definitely is a disadvantage in the CanvasKit renderer. But why and how?'),(0,a.kt)("p",null,'Let us look back on what we learned about how HTML renders. It uses HTML elements, including the text. It makes the text access the default browser/platform-supported fonts. This process of using native fonts is what we call "Native Text Rendering". But why does the CanvasKit renderer not able to access native fonts? Again, when you look back on how CanvasKit renders the page. It has only one Canvas element and paints appropriately using the APIs. The bundle in CanvasKit doesn\'t know the fonts (emojis included), painting only in black and white.'),(0,a.kt)("h4",{id:"solution-1"},"Solution 1"),(0,a.kt)("p",null,"With the new Flutter 3.10, there is a solution to solve this by using Color Emoji with configuring the Flutter engine."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="web/index.html"',title:'"web/index.html"'},"let config = {\n    // uses Color Emoji font\n    useColorEmoji: true,\n};\nengineInitializer.initializeEngine(config);\n")),(0,a.kt)("p",null,"The output after this change when using the CnavasKit renderer for this would be as below:"),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(445).Z,alt:"Native text rendering canvaskit with color emoji output"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Native text rendering with useColorEmoji - canvaskit renderer output")),(0,a.kt)("p",null,"Well, I could say it didn't solve my problem. As you can see in the output from the HTML renderer, it uses the emoji from Apple. But, this solution only gave me the Google Color Emoji font."),(0,a.kt)("h4",{id:"solution-2"},"Solution 2"),(0,a.kt)("p",null,"With the limitation in the previous solution, there is a new page for another solution. It is to ship the font in addition to the already existing bundle. But remember, this solution increases the download size (apart from the 1.5MB)."),(0,a.kt)("p",null,"Add the font file as an asset to your project, say ",(0,a.kt)("inlineCode",{parentName:"p"},"fonts/AppleColorEmoji.ttf"),". Then add it to your ",(0,a.kt)("inlineCode",{parentName:"p"},"pubspec.yaml")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="pubspec.yaml"',title:'"pubspec.yaml"'},"flutter:\n    fonts:\n    - family: AppleColorEmoji\n      fonts:\n        - asset: fonts/AppleColorEmoji.ttf\n")),(0,a.kt)("p",null,"Now change the code to of your ",(0,a.kt)("inlineCode",{parentName:"p"},"Text")," widget to include the font:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart",metastring:'title="Upgraded example code for native text rendering."',title:'"Upgraded',example:!0,code:!0,for:!0,native:!0,text:!0,'rendering."':!0},"Center(\n    child: Text(\n        'Using Emoji - \ud83e\udee8',\n        style: TextStyle(fontFamily: 'AppleColorEmoji'),\n    ),\n),\n")),(0,a.kt)("p",null,"Now looking at the output after the change to include the font file directly into the bundle, we get the desired result with the CanvasKit renderer."),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(6947).Z,alt:"Native text rendering canvaskit with apple font output"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Native text rendering with font file - canvaskit renderer output")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"You could use the ",(0,a.kt)("inlineCode",{parentName:"p"},"RichText")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"Text.rich"),") and ",(0,a.kt)("inlineCode",{parentName:"p"},"TextSpan")," widgets to use different fonts in the same sentence.")),(0,a.kt)("p",null,"Phew! That was a very bumpy ride. It is a widely known issue in the Flutter community for no reason. To learn more on this issue, visit ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/flutter/flutter/issues/119536"},"here"),"."),(0,a.kt)("h3",{id:"problematic-svg-support"},"Problematic SVG support"),(0,a.kt)("p",null,"We know there won't be any more problems with the CanvasKit renderer. The problem here is with the HTML renderer. Considering a simple example displaying an ",(0,a.kt)("a",{target:"_blank",href:n(8563).Z},"SVG image"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart",metastring:'title="Example for svg image."',title:'"Example',for:!0,svg:!0,'image."':!0},"SvgPicture.asset('assets/Firefox.svg'),\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"SvgPicture")," is a widget from the ",(0,a.kt)("a",{parentName:"p",href:"https://pub.dev/packages/flutter_svg"},"flutter_svg")," package.")),(0,a.kt)("p",null,"Comparing the result from both renderers:"),(0,a.kt)("figure",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},(0,a.kt)("figure",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,a.kt)("img",{src:n(1307).Z,style:{height:"200px"},alt:"Output of problematic svg with html renderer"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Firefox SVG - html")),(0,a.kt)("figure",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,a.kt)("img",{src:n(5808).Z,style:{height:"200px"},alt:"Output of problematic svg with canvaskit renderer"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Firefox SVG - canvaskit"))),(0,a.kt)("p",null,"Our assumption about the result from both renderers is True. Here in this example, the gradient color in the HTML renderer is different due to some problems with the SVG support in the HTML renderer. This current problem is with the two-point canonical gradient not being supported."),(0,a.kt)("p",null,"To learn more about this problem and other problems with HTML rendering, start with ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/dnfield/flutter_svg/issues/491#issuecomment-790337290"},"this")," issue."),(0,a.kt)("h3",{id:"canvas-api-limitations"},"Canvas API limitations"),(0,a.kt)("p",null,"Unlike the previous problems with SVG support in HTML renderer, this is another issue with a limitation from using ",(0,a.kt)("a",{parentName:"p",href:"https://api.flutter.dev/flutter/dart-ui/Canvas/saveLayer.html"},(0,a.kt)("inlineCode",{parentName:"a"},"Canvas.saveLayer")),". It closes the door for different uses, like blending colours, etc."),(0,a.kt)("p",null,"I will show you a simple example of how it affects blending in ",(0,a.kt)("a",{target:"_blank",href:n(4774).Z},"this image"),". For more information, visit the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/flutter/flutter/issues/48417"},"Flutter issue"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart",metastring:'title="Example of color blending with SVG."',title:'"Example',of:!0,color:!0,blending:!0,with:!0,'SVG."':!0},"SvgPicture.asset(\n    'assets/flutter_logo.svg',\n    colorFilter: const ColorFilter.mode(Colors.blue, BlendMode.difference),\n),\n")),(0,a.kt)("p",null,"Output for these would be:"),(0,a.kt)("figure",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},(0,a.kt)("figure",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,a.kt)("img",{src:n(7746).Z,style:{height:"200px"},alt:"Output of blending a flutter logo with html renderer"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Flutter SVG blend - html")),(0,a.kt)("figure",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,a.kt)("img",{src:n(4561).Z,style:{height:"200px"},alt:"Output of blending a flutter logo with canvaskit renderer"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Flutter SVG blend - canvaskit"))),(0,a.kt)("p",null,"Now that we are in the concept of Images. Let us look at what they are in Flutter web."),(0,a.kt)("h3",{id:"images-in-flutter-web"},"Images in Flutter Web"),(0,a.kt)("p",null,"On the web, Flutter uses three different methods to display images:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img"},(0,a.kt)("inlineCode",{parentName:"a"},"<img>"))," and ",(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture"},(0,a.kt)("inlineCode",{parentName:"a"},"<picture>"))," - built-in HTML elements",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Has browser caching, image optimization and memory management"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage"},(0,a.kt)("inlineCode",{parentName:"a"},"drawImage"))," on ",(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas"},(0,a.kt)("inlineCode",{parentName:"a"},"<canvas>"))," - Canvas element",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Able to size images and read pixels for further processing"))),(0,a.kt)("li",{parentName:"ul"},"A custom codec that renders to WebGL canvas",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Can apply custom algorithms to pixels, use GLSL (shaders)")))),(0,a.kt)("p",null,"The HTML renderer uses the first two, and the CanvasKit uses the third method from the above three methods."),(0,a.kt)("p",null,"Because of the usage of the ",(0,a.kt)("inlineCode",{parentName:"p"},"<img>")," element by the HTML renderer, it can display images from arbitrary sources. It places some restrictions on what a renderer can do with the Image. Learn more about those limitations from ",(0,a.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/platform-integration/web/web-images#flutter-renderers-on-the-web"},"Flutter docs"),"."),(0,a.kt)("p",null,"CanvasKit, to apply custom image manipulation, need full access to the pixels of the Images. To do so, it is subject to CORS policy."),(0,a.kt)("h3",{id:"cross-origin-resource-sharing-cors"},"Cross-Origin Resource Sharing (CORS)"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"},"CORS")," is a mechanism that allows a server to indicate any origins other than its own from which a browser should permit loading resources."),(0,a.kt)("p",null,"When getting images from different sources (arbitrary sources) into the elements ",(0,a.kt)("inlineCode",{parentName:"p"},"<img>"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"<picture>")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"<canvas>"),", the browser automatically blocks access to the pixel data, and the CORS policy disallows the data. So, the HTML renderer doesn't have issues with the CORS policy apart from a few limitations."),(0,a.kt)("p",null,"CanvasKit renderer needs access to pixels to paint them. So, it needs images to follow CORS policy. And which don't follow the CORS policy (from an arbitrary source) are not displayed on the web page."),(0,a.kt)("p",null,"Let us look at it in action:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart",metastring:'title="Example for CORS policy."',title:'"Example',for:!0,CORS:!0,'policy."':!0},"Image.network('https://somesite.com/someimage.jpg'),\n")),(0,a.kt)("p",null,"Output:"),(0,a.kt)("figure",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,a.kt)("img",{src:n(8298).Z,alt:"Arbitrary source image with html renderer"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Arbitrary source image - html renderer")),(0,a.kt)("figure",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,a.kt)("img",{src:n(3509).Z,alt:"Arbitrary source image with canvaskit renderer"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Arbitrary source image - canvaskit renderer")),(0,a.kt)("p",null,"Seeing this, we learned that to use images from arbitrary sources with CanvasKit renderer following CORS policy is a must. Else, it would throw an error (like above)."),(0,a.kt)("p",null,"What could you do to solve this issue if you want to use an image from an unknown source?"),(0,a.kt)("h4",{id:"solution"},"Solution"),(0,a.kt)("p",null,"There are different methods to solve this issue:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Make the Image an asset",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"It becomes the same-origin as the server following the CORS policy"))),(0,a.kt)("li",{parentName:"ul"},"Host the Image in CORS-enabled CDN",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Content delivery network - configure what domains can access the Image"))),(0,a.kt)("li",{parentName:"ul"},"Use CORS Proxy",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If there is no control of the Image server, use a proxy to load the Images")))),(0,a.kt)("p",null,"To view more in detail on how to use these solutions and how images work with Flutter web, you can go through the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/platform-integration/web/web-images"},"Flutter docs"),"."),(0,a.kt)("h2",{id:"what-to-choose"},"What to Choose?"),(0,a.kt)("p",null,"You have told us a lot!! Now, what renderer do I choose? The reason two renderers are present is for different use cases. So, it depends on what kind of application you are building. After reading this (if you have read it), you can easily decide what renderer you need."),(0,a.kt)("p",null,"To help you, I have curated a few points on when to use what."),(0,a.kt)("figure",null,(0,a.kt)("img",{src:n(4449).Z,alt:"What renderer to choose for flutter web"}),(0,a.kt)("figcaption",{style:{textAlign:"center",fontStyle:"italic",color:"#828282"}},"Classification on what flutter web renderer to choose")),(0,a.kt)("h2",{id:"future---wasm"},"Future - WASM"),(0,a.kt)("p",null,"The future of Flutter web is getting the ",(0,a.kt)("a",{parentName:"p",href:"https://webassembly.org/"},"WebAssembly (Wasm)")," directly instead of going through the ",(0,a.kt)("a",{parentName:"p",href:"https://dart.dev/tools/dart2js"},"dart2js")," (eliminating JavaScript). It would be ",(0,a.kt)("inlineCode",{parentName:"p"},"dart2wasm"),"."),(0,a.kt)("p",null,"The Flutter and Dart team are already working on compiling directly to Wasm instead of Js. And they are almost near getting it out to the public (stable release). With the ",(0,a.kt)("a",{parentName:"p",href:"https://medium.com/dartlang/announcing-dart-3-53f065a10635"},"latest announcement of Dart 3"),", the compatibility for Wasm is not so far. And we also get to experience the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/platform-integration/web/wasm"},"first preview of Wasm")," in the master channel of Flutter."),(0,a.kt)("p",null,"Flutter currently already uses Wasm in the stable channel. Not compiling dart code to Wasm but instead converts the C++ code of CanvasKit (SKIA) to Wasm."),(0,a.kt)("p",null,"As of today (the time of writing this blog), the Build time of the Flutter web with Wasm (master) is slower. But, we can see a smaller download size and faster web application (but with some limitations). You can view the preview app from the release ",(0,a.kt)("a",{parentName:"p",href:"https://flutterweb-wasm.web.app"},"here"),"."),(0,a.kt)("p",null,"Learn more about Wasm in Flutter by visiting ",(0,a.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/platform-integration/web/wasm"},"here")," and watching ",(0,a.kt)("a",{parentName:"p",href:"https://youtu.be/Nkjc9r0WDNo"},"this")," video."),(0,a.kt)("p",null,"In short, it would be a big jump for Flutter on the web once the work with Wasm becomes stable. Performance, Size would be huge factors here."),(0,a.kt)("h2",{id:"conclusion"},"Conclusion"),(0,a.kt)("p",null,"Flutter Web is a vast topic to discuss or ponder upon. There are topics like Fragment Shaders, Element Embedding and many other things. I only choose the concept of renderers as a start because I feel it is a fundamental basic concept that developers need before building web applications in Flutter. It is to provide the current problems/limitations with Flutter Web and to understand different topics related to renderers in Flutter that motivated me to write this blog."),(0,a.kt)("hr",null),(0,a.kt)("p",null,"If this has been useful, please consider sponsoring me via"),(0,a.kt)("iframe",{src:"https://github.com/sponsors/immadisairaj/card",title:"Sponsor immadisairaj",height:"200",width:"600"}))}m.isMDXComponent=!0},8563:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/files/Firefox-d024fc148d129ed6e64964bd211a8598.svg"},4774:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/files/flutter_logo-62e03f4abb59372a3597687dbeaa9e1c.svg"},4561:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/blend-canvaskit-2146bdd0dcab449122ac5f5e2d3b422b.png"},7746:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/blend-html-b448100e4bd2c18511551ea8f7668a47.png"},3509:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/cors-canvaskit-93acd08837ca4ce0e55acf7763968178.png"},8298:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/cors-html-50869ddb6ee2387d389076f41e1642c0.png"},445:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/native-text-canvaskit-color-emoji-be0bfb1622d79d113dfd959c19137846.png"},6947:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/native-text-canvaskit-font-c79f6166110e9b0147100155f9a49bb0.png"},8963:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/native-text-canvaskit-499d26e645fd8066242aa13a6376c89f.png"},8401:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/native-text-html-860a8ac411935835b6a3d79bbb37fae8.png"},5808:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/problem-svg-canvaskit-5e4fecf130861e945444ca54730e3d98.png"},1307:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/problem-svg-html-4bc3e09dfe2dc67da700d352496084d9.png"},9948:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/simple-canvaskit-f8bafa4558eff4c3671d2a985a601f63.png"},8901:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/simple-html-1-7fe681e51ffb0a6f8c3afdaddbde68cd.png"},730:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/simple-html-2-6db6c2741ffd138ddfbd33229afd1307.png"},4449:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/what-to-choose-909959bcca005ed278b98421743421e5.png"},4713:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/simple-rendering-output-2c95aba7e387cad1b1261e69c1c425a3.png"},1544:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/thumbnail-56e335e3804788d89c5489b1c266cbb1.png"},8376:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/web-arch-ec15064fb3ffcae1ebd5d4526daa1066.png"}}]);